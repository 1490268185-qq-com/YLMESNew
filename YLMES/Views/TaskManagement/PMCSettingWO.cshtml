@{
    Layout = null;


}

<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>友力信息管理系统</title>
    <script src="../../My97DatePicker4.7.2/WdatePicker.js"></script>
    <script type="text/javascript" src="http://libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
    <link href="~/css/style.css" rel="stylesheet" type="text/css" />
    <link href="~/layui/css/layui.css" rel="stylesheet" />
    <script type="text/javascript" src="../../js/jquery.js"></script>
    <script src="~/layui/layui.js" type="text/javascript"></script>


    <script type="text/javascript">
        $(function () {
            
            $("#addC").click(function () {
                var sd = $("#u").text();
                window.parent.document.getElementById("rightframe").src = sd;
            });
            $("#edit").click(function () {
                window.parent.document.getElementById("rightframe").src = "/Home/Eidt";
            });
            $("#Construction").click(function () {
                $.ajax({
                    url: "/TaskManagement/CompletionOfWorkOrder",
                    type: "post",
                    dataType: "text",
                    success: function (data) {
                        if (data == "true") {
                            window.setTimeout(function () {
                                alert("确认成功！");
                                window.history.go(-2);
                            }, 500);
                        }
                        else {
                            alert("确认失败！");
                            return;
                        }
                    }
                });
            });
            $("#PurchasingApplication").click(function () {
                window.parent.document.getElementById("rightframe").src = "/TaskManagement/Purchasing?ifDriver="+"@Session["ifB"]"+"&Taskid="+"@ViewData["TaskID2"]";
            });
            layui.use(['table', 'layer'], function () {
                var table = layui.table, layer = layui.layer;
                    table.render({
                        elem: '#tw'
                   , url: '/TaskManagement/TaskMapingWOCheck?taskid=' + '@ViewData["taskid"]'
                   , limit: 15
                   , done: function () {
                             $("tr a").hide()
                             $("tr").hover(function () {
                                 $(this).children().last().children().children().toggle();
                             })
                         }
                        , cols: [[
                            , { field: '', hide: true }
                   , { field: '部件', width: 210, title: '部件'}
                   , { field: '订单数量', width: 210, title: '订单数量' }
                   , { field: '每套数量', width: 235, title: '每套数量' }
                   , {
                       field: '工单数量', width: 180, title: '工单数量',
                     }
                   , { field: '工单名称', title: '工单名称', width: 250 }
                   , { field: 'right', width: 250, align: 'center', toolbar: '#barDemo' }
                   ]]

                });
                table.on('tool(demo)', function (obj) {
                    var data = obj.data;
                    switch (obj.event) {
                        case 'add':
                            var truthBeTold = window.confirm("是否有库存“确定”继续。单击“取消”采购申请。")
                            if (truthBeTold) {
                             id = data.id;
                            PartNumber = data.部件;
                            TotalPCS = data.订单数量
                            TotalQTY = data.工单数量;
                            QTYofOneSet = data.每套数量;
                            TaskID = data.任务编号;
                            ji = data.部件级别;
                            spec = data.部件规格;
                             $.ajax({
                                 url: "/TaskManagement/TurnPwo?pcName=" + "@ViewData["pcNamed"]" + "&PartNumber=" + PartNumber + "&TotalPCS=" + TotalPCS + "&TotalQTY=" + TotalQTY + "&QTYofOneSet=" + QTYofOneSet + "&TaskID=" + TaskID + "&ji=" + ji + "&spec=" + spec,
                                        type: "post",
                                        dataType: "text",
                                        success: function (data) {
                                            if (data == "true") {
                                                window.setTimeout(function () {
                                                    layer.msg('转换成功！');
                                                    var url = "/ProductionPlanning/WorkManagement?taskid=" + TaskID + "&cancle=" + "1";
                                                    var index = layer.open({
                                                        type: 2,
                                                        content: url,
                                                        title: "工单分配",
                                                        maxmin: true
                                                    });
                                                    layer.full(index);
                                                }, 500);
                                            }
                                            else {
                                                alert("转换失败！");
                                                return;
                                            }
                                        }
                                    });
                            } else {
                                TaskID = data.任务编号;
                                PartID = data.部件编号;
                                var url = '/TaskManagement/Purchasing?Taskid=' + TaskID + '&PartID=' + PartID;
                                var index = layer.open({
                                    type: 2,
                                    title: "采购申请信息",
                                    content: url,
                                    maxmin: true
                                });
                                layer.full(index);
                            }                                                      
                            break;
                    };
                });
                });
            });

    </script>
    <script type="text/html" id="barDemo">
        {{#  if(d.工单名称 !=null){ }}

        {{# }else { }}
        <a class="layui-btn layui-btn-xs" id="add" lay-event="add">转生产工单</a>
        {{#  } }}

    </script>


</head>


<body>



    <div class="rightinfo">

        <div class="tools">

            <ul class="toolbar">

                <li>
                    项目名称：
                    <input class="pjName" id="pjName" type="text" style="width:180px;" value="@ViewData["pjname"]" />
                </li>
                <li>
                    产品名称：
                    <input class="pcName" id="pcName" type="text" style="width:180px;" value="@ViewData["pcName"]" />
                </li>
                <li>
                    产品规格：
                    <input class="ProductSpecification" id="ProductSpecification" type="text" style="width:120px;" value="@ViewData["spec"]" />
                </li>
                <li>
                    任务类型：
                    <input class="TaskType" id="TaskType" type="text" style="width: 80px;" value="@ViewData["TaskType"]" />
                </li>
                <li>
                    机械or电气：
                    <input class="Choose" id="Choose" type="text" style="width: 180px;" value="@ViewData["Choose"]" />
                </li>
            </ul>
            @*<button class="layui-btn" id="PurchasingApplication" data-type="reload">采购申请</button>*@
            <button class="layui-btn" id="Construction" data-type="reload">确认完成建工单</button>
        </div>
        <table class="tablelist" id="tw" lay-filter="demo"></table>
    </div>
    <script type="text/javascript" src="~/lib/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript" src="~/lib/layer/2.4/layer.js"></script>
    <script type="text/javascript" src="~/static/h-ui/js/H-ui.min.js"></script>
    <script type="text/javascript" src="~/static/h-ui.admin/js/H-ui.admin.js"></script>
    <script type="text/javascript" src="~/lib/laypage/1.2/laypage.js"></script>
    <script type="text/javascript">
        function admin_add(title, url, w, h) {
            layer_show(title, url, w, h);
        }
    </script>
    <script type="text/javascript">
        $('.tablelist tbody tr:odd').addClass('odd');
    </script>
</body>
</html>
